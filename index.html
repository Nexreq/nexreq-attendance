<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nexreq Attendance</title>
    <!-- Include Tailwind via CDN for basic styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Include React and ReactDOM from unpkg -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>
    <!-- Include Babel for JSX transformation in the browser -->
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  </head>
  <!-- Set a custom background colour using the user provided hex code. We drop the Tailwind background class and instead set an inline style. -->
  <body class="text-gray-900" style="background-color: #255058;">
    <div class="container mx-auto p-4">
      <!-- Header with Nexreq logo (new JPEG on branded background) and title -->
      <div class="flex flex-col items-center mb-4">
        <!-- Use the new company logo image with a dark teal background. This JPEG already contains the tagline. -->
        <img src="./nexreq_logo_new.jpeg" alt="Nexreq Logo" class="h-20 w-auto mb-2" />
        <h1 class="text-3xl font-bold text-white">Nexreq Attendance</h1>
      </div>
      <div id="root"></div>
    </div>
    <script type="text/babel">
      const { useState, useEffect } = React;

      // Default list of employees. Khursheeda Parveen is working from home (WFH) by default.
      const DEFAULT_EMPLOYEES = [
        // Each employee object includes an `onsite` flag.  This flag tracks
        // whether the employee is working on-site at a client location.  The
        // existing `wfh` flag continues to represent working from home.  If
        // neither flag is true, the employee is considered to be in the office.
        { id: 1, name: "Khursheeda Parveen", wfh: true, onsite: false },
        { id: 2, name: "Employee 2", wfh: false, onsite: false },
        { id: 3, name: "Employee 3", wfh: false, onsite: false },
        { id: 4, name: "Employee 4", wfh: false, onsite: false },
        { id: 5, name: "Employee 5", wfh: false, onsite: false },
        { id: 6, name: "Employee 6", wfh: false, onsite: false },
        { id: 7, name: "Employee 7", wfh: false, onsite: false },
        { id: 8, name: "Employee 8", wfh: false, onsite: false },
        { id: 9, name: "Employee 9", wfh: false, onsite: false },
        { id: 10, name: "Employee 10", wfh: false, onsite: false },
      ];

      function AttendanceApp() {
        // User/login state. We persist the current user to localStorage so the
        // page remembers who is logged in. Only users named "Rageeb" or
        // "Mujtaaba" are considered administrators. All others are normal
        // employees who can only clock in/out.
        const [user, setUser] = useState(() => {
          return localStorage.getItem("nexreq_user") || "";
        });
        const [isAdmin, setIsAdmin] = useState(() => {
          const stored = localStorage.getItem("nexreq_user");
          return stored === "Rageeb" || stored === "Mujtaaba";
        });
        const [loginName, setLoginName] = useState("");

        // Employees state: load from localStorage or use defaults
        const [employees, setEmployees] = useState(() => {
          const stored = localStorage.getItem("nexreq_employees");
          if (stored) {
            // Parse stored employees and ensure each has an `onsite` property for
            // compatibility with older data. Default to false if missing.
            const parsed = JSON.parse(stored);
            return parsed.map((e) => ({ ...e, onsite: e.onsite ?? false }));
          }
          return DEFAULT_EMPLOYEES;
        });

        // Account state: maps user names to an object with a passwordHash and admin flag.
        // If there are stored accounts in localStorage, load them; otherwise seed with two
        // default admin accounts. Passwords are stored as base64-encoded strings for
        // simplicity. In a production system you would never store plain passwords in
        // the browser.
        const [accounts, setAccounts] = useState(() => {
          const stored = localStorage.getItem("nexreq_accounts");
          if (stored) return JSON.parse(stored);
          return {
            Rageeb: { passwordHash: btoa("admin123"), isAdmin: true, email: "" },
            Mujtaaba: { passwordHash: btoa("admin123"), isAdmin: true, email: "" },
          };
        });

        // Login and password management state
        // Employees no longer sign up themselves – accounts are created by the admin
        const [loginPassword, setLoginPassword] = useState("");
        const [error, setError] = useState("");
        // Whether the user is resetting a forgotten password
        const [showReset, setShowReset] = useState(false);
        // Temp state for reset email/username and new password
        const [resetIdentifier, setResetIdentifier] = useState("");
        const [resetNewPassword, setResetNewPassword] = useState("");

        // Logs state: each log has {id, employeeId, startTime, endTime, location}
        const [logs, setLogs] = useState(() => {
          const stored = localStorage.getItem("nexreq_logs");
          return stored ? JSON.parse(stored) : [];
        });

        // Date range selection for summary
        const todayStr = new Date().toISOString().split("T")[0];
        const [fromDate, setFromDate] = useState(todayStr);
        const [toDate, setToDate] = useState(todayStr);

        // New employee input
        const [newName, setNewName] = useState("");
        const [newWFH, setNewWFH] = useState(false);
        // Track whether the new employee should be marked as onsite. This is
        // mutually exclusive with WFH; if one is selected the other should
        // automatically clear.
        const [newOnsite, setNewOnsite] = useState(false);
        // Additional fields for admin when creating a new employee (email and password)
        const [newEmail, setNewEmail] = useState("");
        const [newEmpPassword, setNewEmpPassword] = useState("");
        // Allow logged-in users to change their password
        const [changePwVisible, setChangePwVisible] = useState(false);
        const [changePwNew, setChangePwNew] = useState("");

        // Persist employees and logs to localStorage
        useEffect(() => {
          localStorage.setItem("nexreq_employees", JSON.stringify(employees));
        }, [employees]);
        useEffect(() => {
          localStorage.setItem("nexreq_logs", JSON.stringify(logs));
        }, [logs]);

        // Persist accounts to localStorage whenever they change
        useEffect(() => {
          localStorage.setItem("nexreq_accounts", JSON.stringify(accounts));
        }, [accounts]);

        // Handle login and logout
        const handleLogin = () => {
          const entered = loginName.trim();
          const pass = loginPassword;
          setError("");
          if (!entered || !pass) {
            setError("Please enter your username and password.");
            return;
          }
          // Determine the account key: direct username match or email match
          let accountKey = entered;
          if (!accounts[accountKey]) {
            // search by email
            Object.keys(accounts).forEach((uname) => {
              if (accounts[uname].email && accounts[uname].email === entered) {
                accountKey = uname;
              }
            });
          }
          const acct = accounts[accountKey];
          if (!acct || acct.passwordHash !== btoa(pass)) {
            setError("Invalid username or password.");
            return;
          }
          setUser(accountKey);
          setIsAdmin(!!acct.isAdmin);
          localStorage.setItem("nexreq_user", accountKey);
          // Clear password field
          setLoginPassword("");
          setLoginName("");
          // Ensure reset state is hidden
          setShowReset(false);
        };
        const handleLogout = () => {
          setUser("");
          setIsAdmin(false);
          localStorage.removeItem("nexreq_user");
          // also hide any reset or change password UI when logging out
          setShowReset(false);
          setChangePwVisible(false);
        };

        /*
         * Removed handleSignup – employee self sign-up is no longer supported.
         * Employees are now provisioned by the admin and accounts are created
         * with an initial password and email address.
         */

        // Utility: format date/time strings for display
        const formatDateTime = (iso) => {
          if (!iso) return "";
          const d = new Date(iso);
          return (
            d.toLocaleDateString(undefined, {
              year: "numeric",
              month: "short",
              day: "numeric",
            }) +
            " " +
            d.toLocaleTimeString(undefined, { hour: "2-digit", minute: "2-digit" })
          );
        };

        // Add a new employee (admin only). Admin must supply a name, email and initial password.
        // A corresponding account will be created and an informational alert will be shown.
        const addEmployee = () => {
          const name = newName.trim();
          const email = newEmail.trim();
          const pw = newEmpPassword;
          if (!name || !email || !pw) {
            alert("Please enter an employee name, email and password.");
            return;
          }
          // Prevent duplicate usernames
          if (accounts[name]) {
            alert("An account with this username already exists.");
            return;
          }
          // Determine next available employee ID
          const nextId = employees.length ? Math.max(...employees.map((e) => e.id)) + 1 : 1;
          // Create employee record. Ensure the new employee object contains both
          // wfh and onsite flags based on the admin's selections. WFH and
          // onsite are mutually exclusive so whichever is selected defines the
          // location; the other remains false.
          setEmployees([
            ...employees,
            { id: nextId, name: name, wfh: newWFH, onsite: newOnsite },
          ]);
          // Create account with hashed password and email
          setAccounts({
            ...accounts,
            [name]: { passwordHash: btoa(pw), isAdmin: false, email: email },
          });
          // Simulate sending credentials via email by showing an alert. In a real
          // application you would integrate with an email service here.
          alert(`Credentials for ${name} have been created and sent to ${email}.`);
          // Reset form fields
          setNewName("");
          setNewEmail("");
          setNewEmpPassword("");
          setNewWFH(false);
          setNewOnsite(false);
        };

        // Toggle WFH setting for an employee (admin only). When WFH is toggled
        // on, we automatically turn off the onsite flag to maintain exclusivity.
        const toggleWFH = (id) => {
          setEmployees(
            employees.map((e) => {
              if (e.id !== id) return e;
              const newWfh = !e.wfh;
              const newOnsite = newWfh ? false : e.onsite;
              return { ...e, wfh: newWfh, onsite: newOnsite };
            })
          );
        };

        // Toggle Onsite setting for an employee (admin only). When onsite is
        // toggled on, we automatically turn off the WFH flag to maintain
        // exclusivity.
        const toggleOnsite = (id) => {
          setEmployees(
            employees.map((e) => {
              if (e.id !== id) return e;
              const newOnsite = !e.onsite;
              const newWfh = newOnsite ? false : e.wfh;
              return { ...e, onsite: newOnsite, wfh: newWfh };
            })
          );
        };

        // Remove an employee (admin only). This will remove the employee from the list,
        // delete any associated logs, and remove their account if it exists. If the
        // removed employee is currently logged in, log them out.  Note that logs are
        // keyed by employeeId so removing the employee does not require updating
        // existing log records beyond filtering.
        const removeEmployee = (id) => {
          const emp = employees.find((e) => e.id === id);
          if (!emp) return;
          // Confirm with admin before removing
          if (!window.confirm(`Are you sure you want to remove ${emp.name}?`)) return;
          // Remove from employees array
          setEmployees(employees.filter((e) => e.id !== id));
          // Remove logs associated with this employee
          setLogs(logs.filter((log) => log.employeeId !== id));
          // Remove account associated with this name if present
          if (accounts[emp.name]) {
            const newAccounts = { ...accounts };
            delete newAccounts[emp.name];
            setAccounts(newAccounts);
            // If the removed employee is currently logged in, force logout
            if (user === emp.name) {
              setUser("");
              setIsAdmin(false);
              localStorage.removeItem("nexreq_user");
            }
          }
        };

        // Rename an employee (admin only). This prompts the admin for a new name,
        // updates the employees list and corresponding account key. If the current
        // logged in user is being renamed, update the user state accordingly.
        const renameEmployee = (id) => {
          const emp = employees.find((e) => e.id === id);
          if (!emp) return;
          const newName = window.prompt("Enter a new name for this employee", emp.name);
          if (!newName) return;
          const trimmed = newName.trim();
          if (!trimmed || trimmed === emp.name) return;
          // Update employees list
          setEmployees(
            employees.map((e) =>
              e.id === id
                ? { ...e, name: trimmed }
                : e
            )
          );
          // Update accounts: move account under new key if exists
          if (accounts[emp.name]) {
            const newAccounts = { ...accounts };
            newAccounts[trimmed] = newAccounts[emp.name];
            delete newAccounts[emp.name];
            setAccounts(newAccounts);
            // If the renamed employee is currently logged in, update user state
            if (user === emp.name) {
              setUser(trimmed);
              localStorage.setItem("nexreq_user", trimmed);
            }
          }
        };

        // Clock in function
        const clockIn = (employee) => {
          // Determine the location string based on the employee's flags. WFH
          // takes precedence over onsite; onsite takes precedence over office.
          let loc = "Office";
          if (employee.wfh) {
            loc = "WFH";
          } else if (employee.onsite) {
            loc = "Onsite";
          }
          // Create new log entry
          const newLog = {
            id: logs.length ? Math.max(...logs.map((l) => l.id)) + 1 : 1,
            employeeId: employee.id,
            startTime: new Date().toISOString(),
            endTime: null,
            location: loc,
          };
          setLogs([...logs, newLog]);
        };

        // Clock out function
        const clockOut = (employee) => {
          // Find the most recent log without endTime for this employee
          const lastIndex = logs
            .slice()
            .reverse()
            .findIndex((log) => log.employeeId === employee.id && !log.endTime);
          if (lastIndex < 0) return; // nothing to clock out
          const idx = logs.length - 1 - lastIndex;
          const updatedLogs = logs.map((log, i) =>
            i === idx ? { ...log, endTime: new Date().toISOString() } : log
          );
          setLogs(updatedLogs);
        };

        // Check if employee is currently clocked in
        const isClockedIn = (employeeId) => {
          return logs.some(
            (log) => log.employeeId === employeeId && log.endTime === null
          );
        };

        // Compute hours for logs in the selected date range
        const getEmployeeHours = (employeeId) => {
          const from = new Date(fromDate + "T00:00:00");
          const to = new Date(toDate + "T23:59:59");
          let total = 0;
          logs.forEach((log) => {
            if (log.employeeId !== employeeId || !log.endTime) return;
            const start = new Date(log.startTime);
            const end = new Date(log.endTime);
            if (end < from || start > to) return;
            // Clamp start and end within the range
            const s = start < from ? from : start;
            const e = end > to ? to : end;
            total += (e - s) / 3600000; // hours
          });
          return total;
        };

        // Quick ranges
        const setRangeThisWeek = () => {
          const now = new Date();
          const day = now.getDay(); // 0 Sunday
          const diff = now.getDate() - day + (day === 0 ? -6 : 1); // Monday as start
          const monday = new Date(now.setDate(diff));
          const sunday = new Date(monday);
          sunday.setDate(monday.getDate() + 6);
          setFromDate(monday.toISOString().split("T")[0]);
          setToDate(sunday.toISOString().split("T")[0]);
        };
        const setRangeThisMonth = () => {
          const now = new Date();
          const first = new Date(now.getFullYear(), now.getMonth(), 1);
          const last = new Date(now.getFullYear(), now.getMonth() + 1, 0);
          setFromDate(first.toISOString().split("T")[0]);
          setToDate(last.toISOString().split("T")[0]);
        };
        const setRangeLastMonth = () => {
          const now = new Date();
          const first = new Date(now.getFullYear(), now.getMonth() - 1, 1);
          const last = new Date(now.getFullYear(), now.getMonth(), 0);
          setFromDate(first.toISOString().split("T")[0]);
          setToDate(last.toISOString().split("T")[0]);
        };

        // Export logs to CSV
        const exportCSV = () => {
          const lines = [
            "Employee,Start Time,End Time,Hours,Location",
          ];
          logs.forEach((log) => {
            if (!log.endTime) return; // skip open logs
            const emp = employees.find((e) => e.id === log.employeeId);
            const start = formatDateTime(log.startTime);
            const end = formatDateTime(log.endTime);
            const hours = ((new Date(log.endTime) - new Date(log.startTime)) / 3600000).toFixed(2);
            lines.push(
              `${emp ? emp.name : log.employeeId},${start},${end},${hours},${log.location}`
            );
          });
          const csvContent = lines.join("\n");
          const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = url;
          link.download = `nexreq_attendance_logs_${fromDate}_${toDate}.csv`;
          link.click();
          URL.revokeObjectURL(url);
        };

        // If no user is logged in, show a login form or password reset form. Employees
        // no longer self-sign up; accounts are provisioned by an administrator. Once
        // logged in, employees can clock in/out and admins will see additional controls.
        if (!user) {
          // Render the login or password-reset form when no user is logged in.  We wrap
          // both the card and the motivational text in a single container div to
          // satisfy JSX's requirement of a single root element.
          return (
            <div>
              <div className="max-w-md mx-auto bg-white p-6 rounded shadow mt-10">
                <h2 className="text-xl font-semibold mb-4 text-center">
                {showReset ? "Reset Password" : "Login"}
              </h2>
              {error && (
                <p className="mb-2 text-red-600 text-sm text-center">{error}</p>
              )}
              {showReset ? (
                // Password reset form
                <div className="flex flex-col gap-2">
                  <input
                    className="border rounded px-2 py-1"
                    placeholder="Enter your username or email"
                    value={resetIdentifier}
                    onChange={(e) => setResetIdentifier(e.target.value)}
                  />
                  <input
                    type="password"
                    className="border rounded px-2 py-1"
                    placeholder="Enter a new password"
                    value={resetNewPassword}
                    onChange={(e) => setResetNewPassword(e.target.value)}
                  />
                  <button
                    className="px-4 py-2 bg-green-600 text-white rounded"
                    onClick={() => {
                      // Attempt to reset the user's password
                      const identifier = resetIdentifier.trim();
                      const newPass = resetNewPassword;
                      setError("");
                      if (!identifier || !newPass) {
                        setError("Please enter your username/email and a new password.");
                        return;
                      }
                      // Find the account by username or email
                      let foundUser = null;
                      // Check username directly
                      if (accounts[identifier]) {
                        foundUser = identifier;
                      } else {
                        // Search by email in account values
                        Object.keys(accounts).forEach((uname) => {
                          if (accounts[uname].email && accounts[uname].email === identifier) {
                            foundUser = uname;
                          }
                        });
                      }
                      if (!foundUser) {
                        setError("No account found for that username or email.");
                        return;
                      }
                      // Update password hash
                      const updatedAccounts = { ...accounts };
                      updatedAccounts[foundUser] = {
                        ...updatedAccounts[foundUser],
                        passwordHash: btoa(newPass),
                      };
                      setAccounts(updatedAccounts);
                      // Optionally, inform the user via alert that password was reset
                      alert(`Password reset successfully for ${foundUser}. Please log in with your new password.`);
                      // Clear fields and return to login
                      setResetIdentifier("");
                      setResetNewPassword("");
                      setShowReset(false);
                    }}
                  >
                    Reset Password
                  </button>
                  <button
                    className="text-blue-600 text-sm underline mt-2"
                    onClick={() => {
                      // Cancel reset
                      setShowReset(false);
                      setResetIdentifier("");
                      setResetNewPassword("");
                      setError("");
                    }}
                  >
                    Cancel
                  </button>
                </div>
              ) : (
                // Login form
                <div className="flex flex-col gap-2">
                  <input
                    className="border rounded px-2 py-1"
                    placeholder="Enter your username or email"
                    value={loginName}
                    onChange={(e) => setLoginName(e.target.value)}
                  />
                  <input
                    type="password"
                    className="border rounded px-2 py-1"
                    placeholder="Password"
                    value={loginPassword}
                    onChange={(e) => setLoginPassword(e.target.value)}
                  />
                  <button
                    className="px-4 py-2 bg-blue-500 text-white rounded"
                    onClick={handleLogin}
                  >
                    Login
                  </button>
                  <button
                    className="text-blue-600 text-sm underline mt-2"
                    onClick={() => {
                      setShowReset(true);
                      setError("");
                    }}
                  >
                    Forgot password?
                  </button>
                </div>
              )}
              </div>
              {/* Motivational messaging on the login page */}
              <div className="mt-8 max-w-md mx-auto text-center text-white space-y-2">
                <p className="text-lg font-semibold">Be on time — punctuality reflects professionalism.</p>
                <p className="text-lg font-semibold">Stay honest — integrity builds trust.</p>
                <p className="text-lg font-semibold">Embrace teamwork — together we achieve more.</p>
                <p className="text-lg font-semibold">Your commitment makes the difference.</p>
              </div>
            </div>
          );
        }

        return (
          <div className="space-y-8">
            {/* Logged in banner */}
            <div className="flex justify-between items-center bg-white shadow px-4 py-2 rounded">
              <div>
                <span className="font-medium">Logged in as:</span> {user}
                {isAdmin ? (
                  <span className="ml-2 text-sm text-green-600 font-semibold">(Admin)</span>
                ) : (
                  <span className="ml-2 text-sm text-gray-600">(Employee)</span>
                )}
              </div>
              <div className="flex items-center gap-2">
                <button
                  className="px-3 py-1 bg-gray-200 rounded text-sm"
                  onClick={() => setChangePwVisible(!changePwVisible)}
                >
                  Change Password
                </button>
                <button
                  className="px-3 py-1 bg-gray-200 rounded text-sm"
                  onClick={handleLogout}
                >
                  Logout
                </button>
              </div>
            </div>

            {/* Change password form when requested */}
            {changePwVisible && (
              <div className="p-4 bg-white shadow rounded">
                <h3 className="text-md font-semibold mb-2">Change Password</h3>
                <input
                  type="password"
                  className="border rounded px-2 py-1 mb-2 w-full"
                  placeholder="New password"
                  value={changePwNew}
                  onChange={(e) => setChangePwNew(e.target.value)}
                />
                <div className="flex gap-2">
                  <button
                    className="px-3 py-1 bg-green-600 text-white rounded"
                    onClick={() => {
                      if (!changePwNew) {
                        alert("Please enter a new password.");
                        return;
                      }
                      // Update the current user's password
                      const updatedAccounts = { ...accounts };
                      updatedAccounts[user] = {
                        ...updatedAccounts[user],
                        passwordHash: btoa(changePwNew),
                      };
                      setAccounts(updatedAccounts);
                      alert("Password updated successfully.");
                      setChangePwNew("");
                      setChangePwVisible(false);
                    }}
                  >
                    Save
                  </button>
                  <button
                    className="px-3 py-1 bg-gray-300 rounded"
                    onClick={() => {
                      setChangePwNew("");
                      setChangePwVisible(false);
                    }}
                  >
                    Cancel
                  </button>
                </div>
              </div>
            )}

            {/* Employee list and clock actions */}
            <div>
            {/* Section heading for the employee list. We keep the default text color here; background changes are handled by the body style. */}
            <h2 className="text-xl font-semibold mb-2">{isAdmin ? "Employees" : "My Attendance"}</h2>
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                {(isAdmin ? employees : employees.filter((emp) => emp.name === user)).map((emp) => (
                  <div
                    key={emp.id}
                    className="border rounded-lg p-4 bg-white shadow"
                  >
                    <div className="flex justify-between items-center mb-2">
                      <span className="font-medium">{emp.name}</span>
                      <span className="text-xs px-2 py-1 rounded bg-indigo-100 text-indigo-700">
                        {emp.wfh ? "WFH" : emp.onsite ? "Onsite" : "Office"}
                      </span>
                    </div>
                    <div className="flex flex-col space-y-2">
                      <div className="flex gap-2 flex-wrap">
                        {isClockedIn(emp.id) ? (
                          <button
                            className="px-3 py-1 bg-red-500 text-white rounded"
                            onClick={() => clockOut(emp)}
                          >
                            Clock Out
                          </button>
                        ) : (
                          <button
                            className="px-3 py-1 bg-green-500 text-white rounded"
                            onClick={() => clockIn(emp)}
                          >
                            Clock In
                          </button>
                        )}
                        {/* Toggle location flags for editing (admin only). We show both WFH and Onsite toggles when logged in as admin. */}
                        {isAdmin && (
                          <>
                            <button
                              className="px-2 py-1 border rounded text-xs"
                              onClick={() => toggleWFH(emp.id)}
                            >
                              Toggle WFH
                            </button>
                            <button
                              className="px-2 py-1 border rounded text-xs"
                              onClick={() => toggleOnsite(emp.id)}
                            >
                              Toggle Onsite
                            </button>
                          </>
                        )}
                      </div>
                      {/* Admin controls: rename and remove employee */}
                      {isAdmin && (
                        <div className="flex gap-2">
                          <button
                            className="px-2 py-1 border rounded text-xs"
                            onClick={() => renameEmployee(emp.id)}
                          >
                            Edit
                          </button>
                          <button
                            className="px-2 py-1 border rounded text-xs text-red-700"
                            onClick={() => removeEmployee(emp.id)}
                          >
                            Remove
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </div>

            {/* Add Employee (admin only) */}
            {isAdmin && (
              <div className="p-4 bg-white shadow rounded">
                <h2 className="text-lg font-semibold mb-2">Add Employee</h2>
                <div className="flex flex-col gap-2">
                  <input
                    className="border rounded px-2 py-1"
                    placeholder="Employee name"
                    value={newName}
                    onChange={(e) => setNewName(e.target.value)}
                  />
                  <input
                    className="border rounded px-2 py-1"
                    placeholder="Email"
                    value={newEmail}
                    onChange={(e) => setNewEmail(e.target.value)}
                  />
                  <input
                    type="password"
                    className="border rounded px-2 py-1"
                    placeholder="Initial password"
                    value={newEmpPassword}
                    onChange={(e) => setNewEmpPassword(e.target.value)}
                  />
                  <div className="flex flex-wrap items-center gap-2">
                    <label className="flex items-center gap-1">
                      <input
                        type="checkbox"
                        checked={newWFH}
                        onChange={(e) => {
                          const checked = e.target.checked;
                          setNewWFH(checked);
                          if (checked) {
                            // Ensure onsite is cleared when WFH is selected
                            setNewOnsite(false);
                          }
                        }}
                      />
                      WFH
                    </label>
                    <label className="flex items-center gap-1">
                      <input
                        type="checkbox"
                        checked={newOnsite}
                        onChange={(e) => {
                          const checked = e.target.checked;
                          setNewOnsite(checked);
                          if (checked) {
                            // Ensure WFH is cleared when Onsite is selected
                            setNewWFH(false);
                          }
                        }}
                      />
                      Onsite
                    </label>
                    <button
                      className="px-4 py-2 bg-blue-500 text-white rounded"
                      onClick={addEmployee}
                    >
                      Add
                    </button>
                  </div>
                </div>
              </div>
            )}
            {/* Motivational messaging for logged-in users */}
            <div className="p-4 bg-white bg-opacity-10 rounded text-white text-center space-y-2">
              <p className="text-lg font-semibold">Be on time — punctuality reflects professionalism.</p>
              <p className="text-lg font-semibold">Stay honest — integrity builds trust.</p>
              <p className="text-lg font-semibold">Embrace teamwork — together we achieve more.</p>
              <p className="text-lg font-semibold">Your commitment makes the difference.</p>
            </div>

            {/* Summary (admin only) */}
            {isAdmin && (
              <div className="p-4 bg-white shadow rounded">
                <h2 className="text-lg font-semibold mb-2">Summary / Payroll</h2>
                <div className="flex flex-wrap gap-2 mb-2 items-center">
                  <label>
                    From: 
                    <input
                      type="date"
                      className="border rounded px-2 py-1 ml-1"
                      value={fromDate}
                      onChange={(e) => setFromDate(e.target.value)}
                    />
                  </label>
                  <label>
                    To: 
                    <input
                      type="date"
                      className="border rounded px-2 py-1 ml-1"
                      value={toDate}
                      onChange={(e) => setToDate(e.target.value)}
                    />
                  </label>
                  <button
                    className="px-3 py-1 bg-gray-200 rounded"
                    onClick={setRangeThisWeek}
                  >
                    This Week
                  </button>
                  <button
                    className="px-3 py-1 bg-gray-200 rounded"
                    onClick={setRangeThisMonth}
                  >
                    This Month
                  </button>
                  <button
                    className="px-3 py-1 bg-gray-200 rounded"
                    onClick={setRangeLastMonth}
                  >
                    Last Month
                  </button>
                  <button
                    className="px-3 py-1 bg-green-600 text-white rounded ml-auto"
                    onClick={exportCSV}
                  >
                    Export CSV
                  </button>
                </div>
                <div className="overflow-x-auto">
                  <table className="min-w-full border">
                    <thead className="bg-gray-100">
                      <tr>
                        <th className="px-2 py-1 border">Employee</th>
                        <th className="px-2 py-1 border">Hours (in range)</th>
                      </tr>
                    </thead>
                    <tbody>
                      {employees.map((emp) => (
                        <tr key={emp.id} className="even:bg-gray-50">
                          <td className="px-2 py-1 border">{emp.name}</td>
                          <td className="px-2 py-1 border">
                            {getEmployeeHours(emp.id).toFixed(2)}
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(<AttendanceApp />);
    </script>
  </body>
</html>